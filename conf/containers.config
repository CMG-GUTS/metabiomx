executor {
  $local {
      cpus = params.cpus
      queueSize= 12
  }
}

profiles {
    docker {
        docker.enabled          = true
        docker.runOptions       = '-u $(id -u):$(id -g) --rm --security-opt=no-new-privileges'
        singularity.enabled     = false
        }
    singularity {
        singularity.enabled     = true
        singularity.ociAutoPull = false
        docker.enabled          = false
        }
}

process {
    withName: "TRIMMOMATIC" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/trimmomatic.sif' : 'staphb/trimmomatic'}
        ext.args = "MINLEN:60 ILLUMINACLIP:$projectDir/assets/adapters/NexteraPE-PE.fa:2:30:10:8:TRUE SLIDINGWINDOW:4:20 MINLEN:75"
        cpus = params.cpus
    }
    withName: "FASTQC" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/fastqc.sif' : 'staphb/fastqc:latest'}
        cpus = 8
    }
    withName: "MULTIQC" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/multiqc.sif' : 'multiqc/multiqc:latest'}
        cpus = params.cpus
    }
    withName: "KNEADDATA" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/kneaddata.sif' : 'agusinac/kneaddata:latest'}
        cpus = params.cpus
    }
    withName: "INTERLEAVED" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/bbtools.sif' : 'bryce911/bbtools'}
        cpus = 4
    }
    withName: "HUMANN3" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/humann3.sif' : 'biobakery/humann:latest'}
        cpus = params.cpus
    }
    withName: "MERGE_HUMANN3_TABLES" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/humann3.sif' : 'biobakery/humann:latest'}
        cpus = 4
    }
    withName: "SPADES" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/spades.sif' : 'staphb/spades:latest'}
        cpus = params.cpus
    }
    withName: "CATPACK_CONTIGS" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/catpack.sif' : 'agusinac/catpack:latest'}
        cpus = params.cpus
    }
    withName: "READ_ABUNDANCE_ESTIMATION" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/sambowtie2.sif' : 'agusinac/sambowtie2:latest'}
        cpus = params.cpus
    }
    withName: "MERGE_SAM_STATS" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/biopython-train.sif' : 'agusinac/pyrrr:0.2.0'}
        cpus = 1
    }
    withName: "MERGE_MULTIQC_STATS" {
        container = {workflow.containerEngine == 'singularity' ? 'file:///mnt/rtc/pipelines/nextflow-container-images/singularity/biopython-train.sif' : 'agusinac/pyrrr:0.2.0'}
        cpus = 1
    }
}


